<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ramadan Strivers">
<meta name="theme-color" content="#070b14">
<meta name="description" content="Ramadan Strivers ‚Äî Your Ramadan Planner & Tracker. From Muslim to Mu'min.">
<title>Ramadan Strivers</title>
<link rel="manifest" href="data:application/json,%7B%22name%22%3A%22Ramadan%20Strivers%22%2C%22short_name%22%3A%22Ramadan%22%2C%22description%22%3A%22Track%20your%20Ramadan%20journey%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23070b14%22%2C%22theme_color%22%3A%22%23070b14%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%2520viewBox%3D%270%25200%2520100%2520100%27%253E%253Crect%2520fill%3D%27%2523070b14%27%2520width%3D%27100%27%2520height%3D%27100%27%2520rx%3D%2720%27%2F%253E%253Ctext%2520x%3D%2750%27%2520y%3D%2768%27%2520font-size%3D%2755%27%2520text-anchor%3D%27middle%27%253E%25F0%259F%258C%2599%253C%2Ftext%253E%253C%2Fsvg%253E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{--bg:#f5f2ec;--bg2:#fff;--bg-glass:rgba(255,255,255,.72);--bg-header:#070b14;--text:#1c1917;--text2:#57534e;--text3:#a8a29e;--green:#15803d;--green-l:#22c55e;--green-glow:rgba(21,128,61,.12);--gold:#b8860b;--gold-l:#d4a520;--gold-glow:rgba(184,134,11,.12);--border:rgba(120,113,108,.15);--card:#fff;--card-glow:0 1px 3px rgba(0,0,0,.04),0 4px 24px rgba(0,0,0,.06);--success:#16a34a;--warn:#ca8a04;--error:#dc2626;--r:20px;--rs:12px;--overlay:rgba(0,0,0,.45);--safe-t:env(safe-area-inset-top);--safe-b:env(safe-area-inset-bottom);--ff:'Playfair Display',Georgia,serif;--fb:'Source Sans 3',-apple-system,BlinkMacSystemFont,sans-serif}
[data-theme="dark"]{--bg:#070b14;--bg2:#0d1321;--bg-glass:rgba(13,19,33,.82);--bg-header:#050810;--text:#f5f5f4;--text2:#a8a29e;--text3:#57534e;--green:#4ade80;--green-l:#86efac;--green-glow:rgba(74,222,128,.08);--gold:#fbbf24;--gold-l:#fcd34d;--gold-glow:rgba(251,191,36,.08);--border:rgba(245,245,244,.08);--card:rgba(13,19,33,.9);--card-glow:0 1px 3px rgba(0,0,0,.2),0 4px 24px rgba(0,0,0,.25);--success:#22c55e;--warn:#eab308;--error:#ef4444;--overlay:rgba(0,0,0,.7)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}html{scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--bg);color:var(--text);min-height:100dvh;overflow-x:hidden;padding-bottom:calc(72px + var(--safe-b));line-height:1.65;-webkit-font-smoothing:antialiased;font-weight:400;position:relative}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background-image:url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M40 0L80 40L40 80L0 40Z' fill='none' stroke='%23b8860b' stroke-width='0.3' opacity='0.5'/%3E%3Cpath d='M40 15L65 40L40 65L15 40Z' fill='none' stroke='%23b8860b' stroke-width='0.2' opacity='0.3'/%3E%3C/svg%3E");background-size:80px 80px;opacity:.035;animation:geoDrift 90s linear infinite}
[data-theme="dark"] body::before{opacity:.05}
@keyframes geoDrift{from{background-position:0 0}to{background-position:80px 80px}}
body>*{position:relative;z-index:1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
.hdr{background:var(--bg-header);color:#fff;padding:calc(12px + var(--safe-t)) 20px 12px;position:sticky;top:0;z-index:100;backdrop-filter:blur(24px) saturate(1.5);-webkit-backdrop-filter:blur(24px) saturate(1.5);border-bottom:1px solid rgba(251,191,36,.2)}
.hdr-in{display:flex;justify-content:space-between;align-items:center;max-width:540px;margin:0 auto}
.hdr h1{font-family:var(--ff);font-size:1.25em;font-weight:700;letter-spacing:1.5px;text-transform:uppercase}
.hdr h1 span{color:var(--gold-l);font-style:italic;font-weight:400;font-size:.65em;letter-spacing:0;text-transform:none;display:block;margin-top:1px;opacity:.8}
.hdr h1 span{color:var(--gold-l);font-style:italic;font-weight:400;font-size:.65em;letter-spacing:0;text-transform:none;display:block;margin-top:1px;opacity:.8}
.thm-btn{background:rgba(255,255,255,.06);border:1px solid rgba(251,191,36,.3);color:var(--gold-l);width:40px;height:40px;font-size:1.1em;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:12px;transition:all .25s}.thm-btn:active{transform:scale(.9)}
.day-bnr{background:linear-gradient(135deg,#0c1a12 0%,#122a1c 40%,#0f3d2a 100%);color:#fff;padding:26px 20px 22px;text-align:center;position:relative;overflow:hidden}
.day-bnr::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(251,191,36,.06),transparent 60%),radial-gradient(ellipse at 70% 80%,rgba(74,222,128,.05),transparent 50%);pointer-events:none}
.day-bnr::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(251,191,36,.4),transparent)}
.day-bnr.l10{background:linear-gradient(135deg,#0a0820 0%,#170e3a 40%,#1e1155 100%)}
.day-bnr .dn{font-family:var(--ff);font-size:2.6em;font-weight:800;letter-spacing:1px}.day-bnr .dl{font-size:.8em;opacity:.6;margin-top:2px;font-weight:300;letter-spacing:2px;text-transform:uppercase}
.day-bnr .dh{font-family:var(--ff);font-style:italic;font-size:.88em;margin-top:14px;opacity:.8;line-height:1.7;max-width:480px;margin-left:auto;margin-right:auto}
.odd-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#fbbf24,#d97706);color:#1c1917;padding:6px 18px;font-size:.72em;font-weight:700;margin-top:12px;text-transform:uppercase;letter-spacing:2px;border-radius:24px;box-shadow:0 0 30px rgba(251,191,36,.25);animation:pulse-gold 2.5s ease-in-out infinite alternate}
@keyframes pulse-gold{from{box-shadow:0 0 15px rgba(251,191,36,.2)}to{box-shadow:0 0 35px rgba(251,191,36,.4)}}
.l10-msg{margin-top:8px;font-size:.8em;color:#fbbf24;font-family:var(--ff);opacity:.85}
.day-nav{display:flex;align-items:center;justify-content:center;gap:20px;padding:10px 20px;background:var(--bg2);border-bottom:1px solid var(--border)}
.day-nav button{width:38px;height:38px;border-radius:50%;border:1.5px solid var(--border);background:var(--card);color:var(--text);font-size:1em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.day-nav button:active{transform:scale(.88);border-color:var(--green)}
.day-nav .dd{font-weight:600;font-size:.88em;color:var(--text2);min-width:80px;text-align:center;letter-spacing:.5px}
.wrap{max-width:540px;margin:0 auto;padding:14px 16px}.tab{display:none;animation:tabIn .3s ease}.tab.on{display:block}
@keyframes tabIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.prog{background:linear-gradient(135deg,#0c2618,#163d28,#1a5c3a);color:#fff;padding:22px 20px;margin-bottom:12px;border-radius:var(--r);box-shadow:0 4px 30px rgba(21,128,61,.15);position:relative;overflow:hidden}
[data-theme="light"] .prog{background:linear-gradient(135deg,#15803d,#16a34a,#22c55e)}
.prog::before{content:'';position:absolute;top:-30%;right:-15%;width:150px;height:150px;border-radius:50%;background:radial-gradient(circle,rgba(251,191,36,.1),transparent);pointer-events:none}
.prog-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}.prog-title{font-weight:500;font-size:.85em;opacity:.8;letter-spacing:.5px}.prog-pct{font-size:2.4em;font-weight:800;font-family:var(--ff);line-height:1}
.prog-bar-out{background:rgba(255,255,255,.18);height:6px;border-radius:3px;margin-bottom:12px;overflow:hidden}.prog-bar{height:100%;background:linear-gradient(90deg,#fbbf24,#fde68a);border-radius:3px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.prog-bot{display:flex;justify-content:space-between;font-size:.8em;opacity:.75}.prog-pts{color:#fde68a;font-weight:600;opacity:1}
.streaks{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px}
.strk{background:var(--card);border:1.5px solid var(--border);padding:14px 6px;text-align:center;border-radius:var(--rs);transition:all .3s;box-shadow:var(--card-glow)}.strk.on{border-color:var(--gold);box-shadow:0 0 16px var(--gold-glow)}
.strk-i{font-size:1.3em;margin-bottom:3px}.strk-n{font-size:1.5em;font-weight:800;color:var(--green);font-family:var(--ff);line-height:1}.strk-l{font-size:.62em;color:var(--text3);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-top:4px}
.qrn{background:linear-gradient(135deg,#0f0825,#1a1045,#0c2340);color:#fff;padding:22px 20px;margin-bottom:12px;border-radius:var(--r);border:1px solid rgba(251,191,36,.2);position:relative;overflow:hidden}
[data-theme="light"] .qrn{background:linear-gradient(135deg,#1e1b4b,#312e81,#1e3a5f)}
.qrn::before{content:'';position:absolute;top:-40%;right:-20%;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,rgba(251,191,36,.06),transparent);pointer-events:none}
.qrn h3{font-family:var(--ff);font-size:1.15em;margin-bottom:4px;font-weight:700}.qrn-sub{font-size:.78em;opacity:.65;margin-bottom:16px;font-style:italic;font-family:var(--ff);line-height:1.6}
.qrn-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:14px}.qrn-stat{background:rgba(255,255,255,.08);padding:14px 8px;border-radius:var(--rs);text-align:center;backdrop-filter:blur(10px)}
.qrn-val{font-size:1.5em;font-weight:800;font-family:var(--ff);color:#fde68a;line-height:1}.qrn-lbl{font-size:.65em;opacity:.7;margin-top:4px;text-transform:uppercase;letter-spacing:.5px}
.qrn-juz{background:rgba(255,255,255,.06);padding:10px 16px;border-radius:var(--rs);margin-bottom:14px;display:flex;justify-content:space-between;align-items:center;font-size:.88em;border:1px solid rgba(255,255,255,.06)}.qrn-juz span:last-child{font-weight:700;color:#fde68a;font-family:var(--ff);font-size:1.1em}
.qrn-inp{display:flex;gap:8px;align-items:center}.qrn-inp input{flex:1;padding:12px 14px;border-radius:var(--rs);border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.08);color:#fff;font-size:1em;font-family:var(--fb);font-weight:500;transition:border-color .2s}
.qrn-inp input:focus{outline:none;border-color:rgba(251,191,36,.5)}.qrn-inp input::placeholder{color:rgba(255,255,255,.3)}
.qrn-inp button{padding:12px 20px;border-radius:var(--rs);border:none;background:linear-gradient(135deg,#fbbf24,#d97706);color:#1c1917;font-weight:700;cursor:pointer;font-size:.88em;white-space:nowrap;transition:all .2s}.qrn-inp button:active{transform:scale(.95)}
.qrn-bar-out{background:rgba(255,255,255,.12);height:6px;border-radius:3px;margin-top:16px;overflow:hidden}.qrn-bar{height:100%;background:linear-gradient(90deg,#4ade80,#fbbf24);border-radius:3px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.qrn-msg{font-size:.82em;opacity:.7;margin-top:12px;font-style:italic;font-family:var(--ff);line-height:1.6;text-align:center}
.app-link{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.06);padding:10px 14px;border-radius:var(--rs);margin-top:14px;text-decoration:none;color:#fff;transition:all .2s;border:1px solid rgba(255,255,255,.06)}.app-link:active{background:rgba(255,255,255,.12)}
.app-link-txt{font-size:.78em;opacity:.8;flex:1;line-height:1.4}.app-link-txt strong{display:block;font-size:1.1em;margin-bottom:1px;opacity:1}.app-link-go{padding:4px 12px;background:rgba(255,255,255,.1);border-radius:10px;font-size:.68em;font-weight:700;letter-spacing:.5px}
.sec{background:var(--card);border:1px solid var(--border);margin-bottom:10px;overflow:hidden;border-radius:var(--r);box-shadow:var(--card-glow)}.sec.l10-sec{border-color:rgba(251,191,36,.35);box-shadow:0 0 24px var(--gold-glow)}
.sec-hd{background:var(--green);color:#fff;padding:13px 16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none}
[data-theme="dark"] .sec-hd{background:linear-gradient(135deg,rgba(21,128,61,.35),rgba(21,128,61,.2))}[data-theme="light"] .sec-hd{background:linear-gradient(135deg,#15803d,#16a34a)}
.sec-hd h2{font-size:.82em;font-weight:600;letter-spacing:.3px}.sec-prog{display:flex;align-items:center;gap:8px}.sec-prog span:first-child{font-size:.75em;opacity:.8}
.sec-chev{font-size:.65em;transition:transform .3s;color:var(--gold-l)}.sec.shut .sec-chev{transform:rotate(-90deg)}
.sec-bd{padding:10px;max-height:9000px;overflow:hidden;transition:max-height .35s ease,padding .35s ease}.sec.shut .sec-bd{max-height:0;padding:0 10px}
.sub-t{font-size:.75em;font-weight:700;color:var(--gold);padding:8px 0 6px;margin:10px 0 6px;text-transform:uppercase;letter-spacing:1.5px;border-bottom:1px solid var(--gold-glow)}
.hadith-n{background:var(--gold-glow);border-left:3px solid var(--gold);padding:12px 14px;margin:6px 0 10px;border-radius:0 var(--rs) var(--rs) 0;font-family:var(--ff);font-style:italic;font-size:.86em;line-height:1.65;color:var(--text2)}
.ail{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--green-glow);border:1px solid var(--border);border-radius:var(--rs);margin:6px 0 10px;text-decoration:none;color:var(--text);transition:all .2s}
.ail:active{transform:scale(.98);border-color:var(--gold)}.ail-i{font-size:1.4em;flex-shrink:0}.ail-t{font-size:.8em;line-height:1.4;flex:1}.ail-t strong{color:var(--green)}.ail-a{color:var(--green);font-size:1.1em;opacity:.6}
.chk{display:flex;align-items:flex-start;gap:12px;padding:11px 14px;background:var(--bg);border:1px solid var(--border);margin-bottom:5px;border-radius:var(--rs);cursor:pointer;transition:all .2s}.chk:active{transform:scale(.985)}.chk.done{opacity:.45;background:var(--green-glow)}
.chk input[type="checkbox"]{-webkit-appearance:none;appearance:none;width:22px;height:22px;border:2px solid var(--border);border-radius:6px;flex-shrink:0;margin-top:1px;cursor:pointer;position:relative;transition:all .2s;background:var(--card)}
.chk input:checked{border-color:var(--green);background:var(--green)}.chk input:checked::after{content:'‚úì';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-size:.75em;font-weight:700}
.chk label{flex:1;cursor:pointer;font-size:.9em;line-height:1.55;font-weight:400}.chk.done label{text-decoration:line-through}
.chk-pts{font-size:.7em;color:var(--gold);font-weight:700;margin-left:5px}.chk-ref{display:block;font-size:.75em;color:var(--text3);font-style:italic;margin-top:2px}.chk-ref a{color:var(--green);text-decoration:none}
.chk-exp{display:block;font-size:.76em;color:var(--text2);margin-top:3px;line-height:1.45}
.card{background:var(--card);border:1px solid var(--border);margin-bottom:12px;border-radius:var(--r);box-shadow:var(--card-glow);overflow:hidden}
.heat{padding:20px}.heat h3{color:var(--green);font-family:var(--ff);font-size:1.05em;margin-bottom:16px}
.heat-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:5px}
.heat-c{aspect-ratio:1;border-radius:4px;cursor:pointer;transition:transform .15s;display:flex;align-items:center;justify-content:center;font-size:.55em;font-weight:700;color:rgba(255,255,255,.6)}.heat-c:active{transform:scale(1.15)}
.heat-c.h0{background:var(--border);color:var(--text3)}.heat-c.h1{background:#166534}.heat-c.h2{background:#16a34a}.heat-c.h3{background:#22c55e}.heat-c.h4{background:#4ade80}
[data-theme="light"] .heat-c.h0{background:#e7e5e4;color:#78716c}[data-theme="light"] .heat-c.h1{background:#bbf7d0;color:#166534}[data-theme="light"] .heat-c.h2{background:#86efac;color:#14532d}[data-theme="light"] .heat-c.h3{background:#4ade80;color:#fff}[data-theme="light"] .heat-c.h4{background:#16a34a;color:#fff}
.heat-c.h-today{box-shadow:0 0 0 2px var(--gold),0 0 12px var(--gold-glow)}
.heat-leg{display:flex;align-items:center;gap:6px;margin-top:12px;font-size:.7em;color:var(--text3);justify-content:flex-end}
.heat-leg i{width:14px;height:14px;border-radius:3px;display:inline-block}
.heat-leg i.h0{background:var(--border)}.heat-leg i.h1{background:#166534}.heat-leg i.h2{background:#16a34a}.heat-leg i.h3{background:#22c55e}.heat-leg i.h4{background:#4ade80}
[data-theme="light"] .heat-leg i.h1{background:#bbf7d0}[data-theme="light"] .heat-leg i.h2{background:#86efac}[data-theme="light"] .heat-leg i.h3{background:#4ade80}[data-theme="light"] .heat-leg i.h4{background:#16a34a}
.cal{padding:20px}.cal-hd{text-align:center;margin-bottom:18px}.cal-hd h2{color:var(--green);font-family:var(--ff);font-size:1.15em}.cal-hd p{color:var(--text3);font-size:.78em;margin-top:4px}
.cal-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:7px}
.cal-d{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;border:1.5px solid var(--border);background:var(--bg);cursor:pointer;transition:all .2s;position:relative;border-radius:var(--rs)}.cal-d:active{transform:scale(.92)}
.cal-d.cd-today{border-color:var(--gold);box-shadow:0 0 14px var(--gold-glow)}.cal-d.cd-hi{background:var(--success);color:#fff;border-color:var(--success)}.cal-d.cd-md{background:var(--warn);color:#fff;border-color:var(--warn)}.cal-d.cd-lo{background:var(--error);color:#fff;border-color:var(--error)}
.cal-d.cd-odd::after{content:'üåô';position:absolute;top:1px;right:2px;font-size:.5em}.cal-d b{font-size:1em}.cal-d small{font-size:.55em;opacity:.8}
.cal-d.cd-hayd{border-color:#e879a0;background:rgba(236,72,153,.12)}.cal-d.cd-hayd b{color:#f472b6}[data-theme="light"] .cal-d.cd-hayd{background:rgba(236,72,153,.1);border-color:#f9a8d4}
.heat-c.h-hayd{box-shadow:0 0 0 2px #f472b6,0 0 8px rgba(244,114,182,.25)}
.hayd-tgl{background:var(--card);border:1.5px solid var(--border);margin-bottom:12px;border-radius:var(--r);box-shadow:var(--card-glow);overflow:hidden;transition:all .3s}
.hayd-tgl.active{border-color:rgba(244,114,182,.5);box-shadow:0 0 20px rgba(244,114,182,.1)}
.hayd-top{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;gap:12px}
.hayd-info{display:flex;align-items:center;gap:12px;flex:1}.hayd-icon{font-size:1.4em;flex-shrink:0}
.hayd-txt{font-size:.88em;line-height:1.4}.hayd-txt strong{display:block;color:var(--text);font-weight:600;margin-bottom:1px}.hayd-txt span{color:var(--text3);font-size:.85em}
.hayd-sw{width:48px;height:26px;background:var(--border);border:none;cursor:pointer;position:relative;border-radius:13px;transition:all .25s;flex-shrink:0}
.hayd-sw::after{content:'';position:absolute;width:20px;height:20px;background:#fff;top:3px;left:3px;border-radius:50%;transition:transform .25s cubic-bezier(.4,0,.2,1);box-shadow:0 1px 3px rgba(0,0,0,.15)}
.hayd-sw.on{background:linear-gradient(135deg,#ec4899,#f472b6)}.hayd-sw.on::after{transform:translateX(22px)}
.hayd-banner{max-height:0;overflow:hidden;transition:max-height .4s ease,padding .4s ease;padding:0 16px;background:linear-gradient(135deg,rgba(236,72,153,.06),rgba(168,85,247,.06));border-top:1px solid transparent}
.hayd-tgl.active .hayd-banner{max-height:400px;padding:16px;border-top:1px solid rgba(244,114,182,.15)}
.hayd-ayah{font-family:var(--ff);font-style:italic;font-size:.88em;line-height:1.7;color:#f472b6;margin-bottom:10px;padding:12px 14px;background:rgba(244,114,182,.06);border-left:3px solid #f472b6;border-radius:0 var(--rs) var(--rs) 0}
[data-theme="light"] .hayd-ayah{color:#be185d}
.hayd-tips{font-size:.82em;color:var(--text2);line-height:1.6}.hayd-tips strong{color:var(--green);display:block;margin-bottom:4px;font-size:.92em}
.hayd-tips ul{list-style:none;padding:0;margin:0}.hayd-tips li{padding:3px 0;padding-left:18px;position:relative}.hayd-tips li::before{content:'‚ú¶';position:absolute;left:0;color:#f472b6;font-size:.7em;top:5px}
.chk.hayd-off{opacity:.25;pointer-events:none;position:relative;filter:grayscale(.5)}.chk.hayd-off::after{content:'Not required during this period';position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:.6em;color:#f472b6;font-style:italic;background:var(--bg);padding:2px 8px;border-radius:8px}
.scard{background:var(--card);border:1px solid var(--border);padding:20px;margin-bottom:12px;border-radius:var(--r);box-shadow:var(--card-glow)}
.scard h3{color:var(--green);font-size:1em;margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--gold-glow);font-family:var(--ff)}
.sr{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}.sr:last-child{border-bottom:none}.sr-l{color:var(--text2);font-size:.9em}.sr-v{font-weight:600;color:var(--green)}
.chart-wrap{position:relative;height:210px;margin:12px 0}
.cat-bar{margin-bottom:14px}.cat-hd{display:flex;justify-content:space-between;margin-bottom:5px;font-size:.86em}
.cat-trk{background:var(--border);height:7px;border-radius:4px;overflow:hidden}.cat-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--gold));border-radius:4px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.comp-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.comp-c{background:var(--green-glow);border:1px solid var(--border);border-radius:var(--r);padding:18px;text-align:center}
.comp-v{font-size:1.9em;font-weight:800;color:var(--green);font-family:var(--ff);line-height:1}.comp-l{font-size:.78em;color:var(--text2);margin-top:5px}
.comp-delta{border:1px solid var(--border);border-radius:var(--r);padding:16px;text-align:center;margin-bottom:12px;background:var(--card)}
.badges{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.bdg{text-align:center;padding:14px 4px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--rs);transition:all .3s}.bdg.unlk{border-color:var(--gold);background:var(--gold-glow);box-shadow:0 0 12px var(--gold-glow)}.bdg.lck{opacity:.3;filter:grayscale(1)}
.bdg-i{font-size:1.7em;margin-bottom:3px}.bdg-n{font-size:.65em;font-weight:600;color:var(--text2)}
.set-item{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border)}.set-lbl{font-weight:500;font-size:.92em}.set-desc{font-size:.8em;color:var(--text3)}
.tgl{width:48px;height:26px;background:var(--border);border:none;cursor:pointer;position:relative;border-radius:13px;transition:all .25s}.tgl::after{content:'';position:absolute;width:20px;height:20px;background:#fff;top:3px;left:3px;border-radius:50%;transition:transform .25s cubic-bezier(.4,0,.2,1);box-shadow:0 1px 3px rgba(0,0,0,.15)}.tgl.on{background:var(--green)}.tgl.on::after{transform:translateX(22px)}
.btn{padding:13px 24px;border:1.5px solid var(--green);background:var(--green);color:#fff;font-weight:600;cursor:pointer;transition:all .2s;width:100%;margin-top:10px;border-radius:var(--rs);font-family:var(--fb);font-size:.9em;letter-spacing:.3px}.btn:active{transform:scale(.97)}.btn-ol{background:transparent;color:var(--green)}.btn-red{border-color:var(--error);background:var(--error)}.btn-gold{border-color:var(--gold);background:linear-gradient(135deg,#fbbf24,#d97706);color:#1c1917;font-weight:700}
.ftr{text-align:center;padding:28px 20px 16px;margin-top:16px;border-top:1px solid var(--border);color:var(--text3);font-size:.82em;line-height:1.75}.ftr .dua{font-family:var(--ff);font-style:italic;font-size:1.05em;color:var(--gold);margin-bottom:10px}.ftr a{color:var(--green);text-decoration:none;font-weight:600}
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--bg-glass);border-top:1px solid var(--border);display:flex;padding:0 8px;padding-bottom:var(--safe-b);z-index:100;backdrop-filter:blur(24px) saturate(1.5);-webkit-backdrop-filter:blur(24px) saturate(1.5)}
.bnav-i{flex:1;padding:8px 0;display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;color:var(--text3);border:none;background:transparent;transition:all .2s;font-family:var(--fb);position:relative}.bnav-i.on{color:var(--green)}.bnav-i.on::before{content:'';position:absolute;top:0;left:25%;right:25%;height:2px;background:var(--green);border-radius:0 0 2px 2px}.bnav-i .ni{font-size:1.25em}.bnav-i .nl{font-size:.6em;font-weight:700;text-transform:uppercase;letter-spacing:.7px}
.mdl-o{display:none;position:fixed;inset:0;background:var(--overlay);z-index:200;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}.mdl-o.on{display:flex}
.mdl{background:var(--card);border:1px solid var(--border);width:100%;max-width:400px;max-height:80vh;overflow-y:auto;border-radius:var(--r);box-shadow:0 25px 60px rgba(0,0,0,.3)}
.mdl-hd{background:var(--green);color:#fff;padding:16px 20px;display:flex;justify-content:space-between;align-items:center}[data-theme="dark"] .mdl-hd{background:linear-gradient(135deg,rgba(21,128,61,.4),rgba(21,128,61,.25))}
.mdl-hd h3{font-size:1em;font-family:var(--ff)}.mdl-x{background:transparent;border:none;color:#fff;font-size:1.5em;cursor:pointer;opacity:.7}.mdl-x:hover{opacity:1}.mdl-bd{padding:20px}
.inst{display:none;background:linear-gradient(135deg,#15803d,#16a34a);color:#fff;padding:14px 16px;margin-bottom:12px;border-radius:var(--r);box-shadow:0 4px 20px rgba(21,128,61,.2)}.inst.show{display:flex;align-items:center;gap:12px}.inst .it{flex:1;font-size:.86em;line-height:1.4}.inst .it strong{display:block;margin-bottom:1px}
.inst button{padding:8px 16px;border-radius:var(--rs);border:none;background:#fff;color:var(--green);font-weight:700;cursor:pointer;font-size:.82em;white-space:nowrap}.inst .ix{background:transparent;color:rgba(255,255,255,.6);font-size:1.3em;padding:0 4px}
.toast-c{position:fixed;top:calc(70px + var(--safe-t));left:50%;transform:translateX(-50%);z-index:300;display:flex;flex-direction:column;gap:8px;pointer-events:none;max-width:85%}
.toast{background:var(--green);color:#fff;padding:12px 20px;font-size:.86em;font-weight:500;border-radius:var(--rs);animation:tIn .3s ease,tOut .3s ease 2.7s;box-shadow:0 8px 30px rgba(0,0,0,.2)}.toast.bdg-t{background:linear-gradient(135deg,#fbbf24,#d97706);color:#1c1917}
@keyframes tIn{from{transform:translateY(-16px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes tOut{from{opacity:1}to{opacity:0}}
@media(max-width:400px){.hdr h1{font-size:1.05em}.streaks{grid-template-columns:repeat(2,1fr)}.badges{grid-template-columns:repeat(3,1fr)}.cal-grid{grid-template-columns:repeat(5,1fr)}.heat-grid{gap:3px}.heat-c{font-size:.45em}}
</style>
</head>
<body>
<header class="hdr"><div class="hdr-in"><div><h1>üåô Ramadan Strivers <span>Your Ramadan Planner & Tracker</span><span>From Muslim to Mu'min ‚Äî bringing out our best</span></h1></div><button class="thm-btn" onclick="toggleTheme()" aria-label="Toggle theme"><span id="themeIcon">‚òÄÔ∏è</span></button></div></header>
<div class="day-bnr" id="dayBanner"><div class="dn">Day <span id="currentDay">1</span></div><div class="dl">Ramadan 1447</div><div class="dh" id="dailyHadith"></div><div id="oddBadge"></div><div id="l10Msg"></div></div>
<div class="day-nav"><button onclick="changeDay(-1)" aria-label="Previous">‚óÄ</button><div class="dd" id="dayDisp">Day 1 / 30</div><button onclick="changeDay(1)" aria-label="Next">‚ñ∂</button></div>
<main class="wrap">
<div class="inst" id="instBanner"><div style="font-size:1.6em">üåô</div><div class="it"><strong>Install Ramadan Strivers</strong>Add to your home screen for the best experience</div><button id="instBtn" onclick="installApp()">Install</button><button class="ix" onclick="dismissInst()">&times;</button></div>
<div class="tab on" id="tab-today">
<div class="prog"><div class="prog-top"><span class="prog-title">Today's Progress</span><span class="prog-pct" id="pPct">0%</span></div><div class="prog-bar-out"><div class="prog-bar" id="pBar" style="width:0%"></div></div><div class="prog-bot"><span id="pCnt">0 of 0 completed</span><span class="prog-pts">üî• <span id="pPts">0</span> pts</span></div></div>
<div class="hayd-tgl" id="haydTgl"><div class="hayd-top" onclick="toggleHayd()"><div class="hayd-info"><div class="hayd-icon">üå∏</div><div class="hayd-txt"><strong>Sisters ‚Äî Menstrual Cycle</strong><span>Toggle if you are on your period today</span></div></div><button class="hayd-sw" id="haydSw" type="button"></button></div><div class="hayd-banner"><div class="hayd-ayah">"Allah does not burden a soul beyond that it can bear." ‚Äî Quran 2:286</div><div class="hayd-tips"><strong>üå∏ Your worship continues ‚Äî here's what you can focus on:</strong><ul><li>Increase dhikr, istighfar & salawat throughout the day</li><li>Make abundant dua, especially during salah times</li><li>Listen to Quran recitation & reflect on its meanings</li><li>Give charity ‚Äî even a smile is sadaqah</li><li>Serve your family & community</li><li>Work on character, patience & gratitude</li><li>Morning & evening adhkar for protection</li><li>Make dua for others in their absence (the angel says "Amin, and for you the same")</li></ul></div></div></div>
<div class="streaks"><div class="strk" id="sFajr"><div class="strk-i">‚òÄÔ∏è</div><div class="strk-n" id="sFajrN">0</div><div class="strk-l">Fajr</div></div><div class="strk" id="sNight"><div class="strk-i">üåô</div><div class="strk-n" id="sNightN">0</div><div class="strk-l">Night</div></div><div class="strk" id="sQuran"><div class="strk-i">üìñ</div><div class="strk-n" id="sQuranN">0</div><div class="strk-l">Quran</div></div><div class="strk" id="sCharity"><div class="strk-i">üíù</div><div class="strk-n" id="sCharityN">0</div><div class="strk-l">Sadaqah</div></div></div>
<div class="qrn"><h3>üìñ Quran Completion Tracker</h3><div class="qrn-sub">"The month of Ramadan in which the Quran was revealed as guidance for mankind." ‚Äî Quran 2:185<br>Read it. Understand it. Live by it.</div><div class="qrn-grid"><div class="qrn-stat"><div class="qrn-val" id="qRead">0</div><div class="qrn-lbl">Pages Read</div></div><div class="qrn-stat"><div class="qrn-val" id="qLeft">604</div><div class="qrn-lbl">Pages Left</div></div><div class="qrn-stat"><div class="qrn-val" id="qDays">30</div><div class="qrn-lbl">Days Left</div></div><div class="qrn-stat"><div class="qrn-val" id="qPace">~20</div><div class="qrn-lbl">Pages/Day Needed</div></div></div><div class="qrn-juz"><span style="opacity:.7">Current Juz</span><span id="qJuz">‚Äî / 30</span></div><div class="qrn-inp"><input type="number" id="qInp" placeholder="Pages read today" min="0" step="1"><button onclick="logQuran()">Log</button></div><div class="qrn-bar-out"><div class="qrn-bar" id="qBar" style="width:0%"></div></div><div class="qrn-msg" id="qMsg">Read, understand, and implement ‚Äî even one ayah a day transforms your life.</div><a href="https://tarteel.ai/" target="_blank" rel="noopener" class="app-link"><div style="font-size:1.3em">üìñ</div><div class="app-link-txt"><strong>Tarteel AI</strong>AI Quran recitation ‚Äî tajweed correction & memorisation</div><div class="app-link-go">Open ‚Üí</div></a></div>
<div id="chkContainer"></div>
</div>
<div class="tab" id="tab-calendar"><div class="card heat"><h3>üü© Consistency Heatmap</h3><div class="heat-grid" id="heatGrid"></div><div class="heat-leg">Less <i class="h0"></i><i class="h1"></i><i class="h2"></i><i class="h3"></i><i class="h4"></i> More</div></div><div class="card cal"><div class="cal-hd"><h2>üìÖ 30-Day Journey</h2><p>Tap any day to view details</p></div><div class="cal-grid" id="calGrid"></div></div><div class="scard" style="margin-top:0"><h3>üìä Legend</h3><div style="display:flex;gap:14px;flex-wrap:wrap;font-size:.82em"><span><i style="display:inline-block;width:12px;height:12px;background:var(--success);vertical-align:middle;margin-right:4px;border-radius:3px"></i>76-100%</span><span><i style="display:inline-block;width:12px;height:12px;background:var(--warn);vertical-align:middle;margin-right:4px;border-radius:3px"></i>51-75%</span><span><i style="display:inline-block;width:12px;height:12px;background:var(--error);vertical-align:middle;margin-right:4px;border-radius:3px"></i>1-50%</span><span>üåô Odd Night</span><span>üå∏ Cycle Day</span></div></div></div>
<div class="tab" id="tab-stats"><div id="compSection"><div class="comp-row" id="compRow"><div class="comp-c"><div class="comp-v" id="cW1">0%</div><div class="comp-l" id="cW1L">Week 1 Avg</div></div><div class="comp-c"><div class="comp-v" id="cW2">0%</div><div class="comp-l" id="cW2L">Week 2 Avg</div></div></div><div class="comp-delta" id="cDelta" style="display:none"><div class="comp-v" id="cDV">‚Äî</div><div class="comp-l" id="cDL">Compared to last week</div></div></div><div class="scard"><h3>üìà Daily Progress Trend</h3><div class="chart-wrap"><canvas id="trendChart"></canvas></div></div><div class="scard"><h3>üìñ Quran Pages Over Time</h3><div class="chart-wrap"><canvas id="quranChart"></canvas></div></div><div class="scard"><h3>üìä Category Breakdown (Today)</h3><div id="catBrk"></div></div><div class="scard"><h3>üìà Overall Progress</h3><div class="sr"><span class="sr-l">Days Completed</span><span class="sr-v" id="sDC">0 / 30</span></div><div class="sr"><span class="sr-l">Average Completion</span><span class="sr-v" id="sAC">0%</span></div><div class="sr"><span class="sr-l">Total Points</span><span class="sr-v" id="sTP">0</span></div><div class="sr"><span class="sr-l">Best Day</span><span class="sr-v" id="sBD">-</span></div><div class="sr"><span class="sr-l">Perfect Days (100%)</span><span class="sr-v" id="sPD">0</span></div><div class="sr"><span class="sr-l">Quran Pages Read</span><span class="sr-v" id="sQT">0 / 604</span></div></div><div class="scard"><h3>üèÖ Achievements (<span id="bdgCnt">0</span>/12)</h3><div class="badges" id="bdgGrid"></div></div><div class="scard"><h3>üî• Best Streaks</h3><div class="sr"><span class="sr-l">‚òÄÔ∏è Fajr</span><span class="sr-v" id="bsF">0 days</span></div><div class="sr"><span class="sr-l">üåô Night Prayer</span><span class="sr-v" id="bsN">0 days</span></div><div class="sr"><span class="sr-l">üìñ Quran</span><span class="sr-v" id="bsQ">0 days</span></div><div class="sr"><span class="sr-l">üíù Sadaqah</span><span class="sr-v" id="bsC">0 days</span></div></div></div>
<div class="tab" id="tab-more"><div class="scard"><h3>üìò How to Use ‚Äî Feature Guide</h3><div style="font-size:.86em;color:var(--text2);line-height:1.75"><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üìã Today Tab ‚Äî Your Daily Checklist</strong><br>This is your main page. Each day shows 80+ items across 8 categories ‚Äî salah, Quran, character, charity, and more. Simply tick off what you've completed. Every item has a hadith reference and explanation so you understand <em>why</em> it matters. Points are awarded for each item, and they multiply during the last 10 nights!</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üå∏ Sisters' Menstrual Cycle Toggle</strong><br>At the top of the Today page. When toggled on, salah, fasting, and i'tikaf items are automatically greyed out and your progress recalculates against the remaining items ‚Äî so you can still reach 100% for the day. It also shows worship tips for this period. The toggle saves per day, so each day remembers its own state.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üìñ Quran Completion Tracker</strong><br>Log how many pages you read each day. The tracker calculates your pace ‚Äî how many pages per day you need to finish the Quran by Day 30. It shows your current Juz, total pages, and a motivational message. Logging pages also auto-ticks "Quran recitation" in your checklist.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üî• Streaks</strong><br>Four streak counters track your consecutive days of Fajr, Night prayer, Quran, and Charity. Keep them going! Your best streaks are saved permanently even if a streak breaks.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">‚óÄ ‚ñ∂ Day Navigation</strong><br>Use the arrows to move between days. You can go back to fill in a day you missed or look ahead. All data saves automatically per day.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üìÖ Calendar Tab</strong><br>See your entire Ramadan at a glance. The heatmap shows consistency with colour intensity, and the 30-day calendar colour-codes each day (green = 76%+, yellow = 51-75%, red = 1-50%). Tap any day to see a detailed breakdown of what you completed. Odd nights are marked with üåô and cycle days with üå∏.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üìä Stats Tab</strong><br>Your analytics dashboard. See weekly comparisons (from Week 2 onwards), daily progress trends on a chart, Quran reading progress vs target pace, category breakdowns, overall stats, achievement badges (12 to unlock!), and your best streaks.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üèÖ Badges & Achievements</strong><br>12 badges to earn ‚Äî from "First Step" (complete anything on Day 1) to "Champion" (70%+ every single day). Special badges for the Abu Bakr Challenge, Fajr Warriors, and Last 10 Heroes. Check the Stats tab to see your progress.</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üåô Last 10 Nights</strong><br>From Day 21, a special "Last 10 Nights" category appears with extra items for seeking Laylatul Qadr. Points double on all even nights and <em>triple</em> on odd nights (21, 23, 25, 27, 29).</div><div style="padding:12px 0;border-bottom:1px solid var(--border)"><strong style="color:var(--green);font-size:1.05em">üìÑ PDF Report</strong><br>Download a full progress report as a PDF ‚Äî includes daily breakdown, streaks, points, and Quran progress. Great for reflection or sharing with an accountability partner.</div><div style="padding:12px 0"><strong style="color:var(--green);font-size:1.05em">üíæ Data & Privacy</strong><br>All your data is stored locally on your device ‚Äî no accounts, no servers, no tracking. Use Export/Import to back up your data or transfer between devices. The app works fully offline once loaded.</div></div></div><div class="scard"><h3>‚öôÔ∏è Settings</h3><div class="set-item"><div><div class="set-lbl">Dark Mode</div><div class="set-desc">Easier on eyes at night</div></div><button class="tgl" id="dmTgl" onclick="toggleTheme()"></button></div></div><div class="scard"><h3>üìÑ Download Progress Report</h3><p style="font-size:.86em;color:var(--text2);margin-bottom:12px;line-height:1.5">Download a PDF summary of your Ramadan progress with daily breakdown, streaks, and all your data.</p><button class="btn btn-gold" onclick="genPDF()">üìÑ Download PDF Report</button></div><div class="scard"><h3>üíæ Data Management</h3><button class="btn btn-ol" onclick="exportData()">üì§ Export Data (JSON)</button><button class="btn btn-ol" onclick="document.getElementById('impFile').click()">üì• Import Data</button><input type="file" id="impFile" accept=".json" onchange="importData(event)" style="display:none"><button class="btn btn-red" onclick="confirmReset()">üóëÔ∏è Reset All Data</button></div><div class="scard"><h3>‚ÑπÔ∏è About</h3><p style="color:var(--text2);line-height:1.75;font-size:.88em"><strong>Ramadan Strivers</strong><br>Your Ramadan Planner & Tracker<br>From Muslim to Mu'min ‚Äî bringing out our best<br><br>Version 4.1 ¬∑ Works offline ¬∑ No account needed ¬∑ Data stored locally</p></div></div>
<div class="ftr"><div class="dua">May Allah accept our fasting and deeds. Ramadan Mubarak! üåô</div><p>For corrections, suggestions & feedback<br>please reach out to <a href="/cdn-cgi/l/email-protection#137e3d7572617b727d3d7172657253747e727a7f3d707c7e">Farhan</a></p><p style="margin-top:6px;font-size:.75em;opacity:.5">Built with ‚ù§Ô∏è for the Ummah</p></div>
</main>
<nav class="bnav"><button class="bnav-i on" data-tab="today" onclick="goTab('today')"><span class="ni">üìã</span><span class="nl">Today</span></button><button class="bnav-i" data-tab="calendar" onclick="goTab('calendar')"><span class="ni">üìÖ</span><span class="nl">Calendar</span></button><button class="bnav-i" data-tab="stats" onclick="goTab('stats')"><span class="ni">üìä</span><span class="nl">Stats</span></button><button class="bnav-i" data-tab="more" onclick="goTab('more')"><span class="ni">‚öôÔ∏è</span><span class="nl">More</span></button></nav>
<div class="mdl-o" id="dayModal"><div class="mdl"><div class="mdl-hd"><h3 id="mdlTitle">Day 1</h3><button class="mdl-x" onclick="closeMdl()">&times;</button></div><div class="mdl-bd" id="mdlBody"></div></div></div>
<div class="toast-c" id="toastC"></div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
const TOTAL_Q=604,PPJ=604/30;
const HADITHS=[{t:"Whoever fasts Ramadan out of faith and seeking reward, his previous sins will be forgiven.",s:"Bukhari 38",l:"https://sunnah.com/bukhari:38"},{t:"When Ramadan begins, the gates of Paradise are opened and the gates of Hell are closed.",s:"Bukhari 1899",l:"https://sunnah.com/bukhari:1899"},{t:"Fasting is a shield; so when one of you is fasting, let him not speak obscenely or act ignorantly.",s:"Bukhari 1894",l:"https://sunnah.com/bukhari:1894"},{t:"There is a gate in Paradise called Ar-Rayyan, through which only those who fast will enter.",s:"Bukhari 1896",l:"https://sunnah.com/bukhari:1896"},{t:"Whoever gives iftar to a fasting person will have the same reward without reducing theirs.",s:"Tirmidhi 807",l:"https://sunnah.com/tirmidhi:807"},{t:"The supplication of the fasting person is not rejected.",s:"Ibn Majah 1753",l:"https://sunnah.com/ibnmajah:1753"},{t:"Fasting and the Quran will intercede for the servant on the Day of Resurrection.",s:"Ahmad 6626",l:""},{t:"Every action of the son of Adam is for him except fasting, for it is for Me and I shall reward it.",s:"Bukhari 1904",l:"https://sunnah.com/bukhari:1904"},{t:"Whoever does not give up false speech, Allah has no need of him giving up food and drink.",s:"Bukhari 1903",l:"https://sunnah.com/bukhari:1903"},{t:"Seek Laylatul Qadr in the odd nights of the last ten days of Ramadan.",s:"Bukhari 2017",l:"https://sunnah.com/bukhari:2017"},{t:"The best charity is that given in Ramadan.",s:"Tirmidhi 663",l:"https://sunnah.com/tirmidhi:663"},{t:"Whoever stands in prayer on Laylatul Qadr out of faith, his past sins will be forgiven.",s:"Bukhari 1901",l:"https://sunnah.com/bukhari:1901"},{t:"The Prophet was the most generous in Ramadan when Jibreel would meet him.",s:"Bukhari 6",l:"https://sunnah.com/bukhari:6"},{t:"Ramadan is the month of patience, and patience is rewarded with Paradise.",s:"Ibn Khuzaymah 1887",l:""},{t:"When the last ten days began, the Prophet would tighten his waist belt and pray all night.",s:"Bukhari 2024",l:"https://sunnah.com/bukhari:2024"},{t:"There is nothing equivalent to fasting.",s:"Nasai 2220",l:"https://sunnah.com/nasai:2220"},{t:"The breath of a fasting person is sweeter to Allah than the scent of musk.",s:"Bukhari 1904",l:"https://sunnah.com/bukhari:1904"},{t:"Whoever prays qiyam in Ramadan with faith and seeking reward will be forgiven.",s:"Bukhari 37",l:"https://sunnah.com/bukhari:37"},{t:"Make dua to Allah with certainty that He will answer.",s:"Tirmidhi 3479",l:"https://sunnah.com/tirmidhi:3479"},{t:"The strong is not the one who overcomes people, but who controls himself when angry.",s:"Bukhari 6114",l:"https://sunnah.com/bukhari:6114"},{t:"Laylatul Qadr is better than a thousand months.",s:"Quran 97:3",l:""},{t:"Whoever draws near to Allah with good character is like one who fasts and prays all night.",s:"Abu Dawud 4798",l:"https://sunnah.com/abudawud:4798"},{t:"Allahumma innaka 'afuwwun tuhibbul 'afwa fa'fu 'anni ‚Äî O Allah, You are Pardoning‚Ä¶",s:"Tirmidhi 3513",l:"https://sunnah.com/tirmidhi:3513"},{t:"The one who recites Quran skillfully is with the noble scribes (angels).",s:"Bukhari 4937",l:"https://sunnah.com/bukhari:4937"},{t:"Allah extends His hand at night to accept repentance of those who sinned by day.",s:"Muslim 2759",l:"https://sunnah.com/muslim:2759"},{t:"Whoever believes in Allah and the Last Day, let him speak good or remain silent.",s:"Bukhari 6018",l:"https://sunnah.com/bukhari:6018"},{t:"Nothing is heavier on the Scale than good character.",s:"Tirmidhi 2003",l:"https://sunnah.com/tirmidhi:2003"},{t:"The best of you are those who are best to their families.",s:"Tirmidhi 3895",l:"https://sunnah.com/tirmidhi:3895"},{t:"Charity does not decrease wealth.",s:"Muslim 2588",l:"https://sunnah.com/muslim:2588"},{t:"Whoever fasts Ramadan then follows it with six days of Shawwal, it is as if he fasted forever.",s:"Muslim 1164",l:"https://sunnah.com/muslim:1164"}];
const BADGES=[{id:'firstStep',name:'First Step',icon:'üå±'},{id:'weekOne',name:'Week One',icon:'üìÖ'},{id:'halfway',name:'Halfway',icon:'üéØ'},{id:'fajrWarrior',name:'Fajr Warrior',icon:'‚òÄÔ∏è'},{id:'nightOwl',name:'Night Owl',icon:'ü¶â'},{id:'quranLover',name:'Quran Lover',icon:'üìñ'},{id:'generous',name:'Generous',icon:'üíé'},{id:'abuBakr',name:'Abu Bakr',icon:'ü•á'},{id:'abuBakrG',name:'Abu Bakr Gold',icon:'üèÜ'},{id:'l10Hero',name:'Last 10 Hero',icon:'üåü'},{id:'perfect',name:'Perfectionist',icon:'‚ú®'},{id:'champion',name:'Champion',icon:'üëë'}];
const CK=[
{id:'salah',title:'1. SALAH, SUNNAH & DHIKR',hn:'"Whoever attends Isha in congregation has the reward of standing half the night. And whoever prays Isha and Fajr in congregation has the reward of standing the entire night." ‚Äî Muslim 656',subs:[
{name:'üåÖ Fajr & Morning',items:[
{id:'fajr-sunnah',label:'2 Sunnah before Fajr',ref:'Muslim 724',rl:'https://sunnah.com/muslim:724',exp:'Better than the world and all it contains.',pts:8},
{id:'fajr',label:'Fajr prayer',ref:'Bukhari 555',rl:'https://sunnah.com/bukhari:555',exp:'Foundation of the day; the angels of night and day witness it.',pts:15,stk:'fajr'},
{id:'morning-adhkar',label:'Morning adhkar',ref:'Abu Dawud 5068',rl:'https://sunnah.com/abudawud:5068',exp:'Prophetic protection until evening.',pts:5,al:'lwa'},
{id:'istighfar',label:'Istighfar (seek forgiveness)',ref:'Bukhari 6307',rl:'https://sunnah.com/bukhari:6307',exp:'The Prophet sought forgiveness more than 70 times daily.',pts:5},
{id:'salawat',label:'Salawat upon the Prophet Ô∑∫',ref:'Muslim 408',rl:'https://sunnah.com/muslim:408',exp:'One salawat brings ten blessings from Allah.',pts:5},
{id:'duha',label:'Duha prayer (2-8 rakahs)',ref:'Muslim 720',rl:'https://sunnah.com/muslim:720',exp:'Charity for every joint in your body.',pts:5}
]},
{name:'‚òÄÔ∏è Dhuhr & Asr',items:[
{id:'dhuhr-sunnah-before',label:'4 Sunnah before Dhuhr',ref:'Tirmidhi 428',rl:'https://sunnah.com/tirmidhi:428',exp:'Regular Sunnah of the Prophet.',pts:8},
{id:'dhuhr',label:'Dhuhr prayer',ref:'Quran 17:78',rl:'',exp:'Midday obligation ‚Äî establishes rhythm of worship.',pts:15},
{id:'dhuhr-sunnah-after',label:'2 Sunnah after Dhuhr',ref:'Tirmidhi 428',rl:'https://sunnah.com/tirmidhi:428',exp:'Twelve daily Sunnah rakahs earn a house in Jannah.',pts:8},
{id:'asr',label:'Asr prayer',ref:'Bukhari 553',rl:'https://sunnah.com/bukhari:553',exp:'Guarding Asr is specifically emphasised.',pts:15}
]},
{name:'üåá Maghrib & Evening',items:[
{id:'dua-iftar',label:'Dua at iftar',ref:'Abu Dawud 2357',rl:'https://sunnah.com/abudawud:2357',exp:'The dua of the fasting person at iftar is not rejected.',pts:5},
{id:'maghrib',label:'Maghrib prayer',ref:'Bukhari 560',rl:'https://sunnah.com/bukhari:560',exp:'Marks the breaking of fast.',pts:15},
{id:'maghrib-sunnah',label:'2 Sunnah after Maghrib',ref:'Bukhari 1183',rl:'https://sunnah.com/bukhari:1183',exp:'Prayed regularly by the Prophet.',pts:8},
{id:'evening-adhkar',label:'Evening adhkar',ref:'Abu Dawud 5068',rl:'https://sunnah.com/abudawud:5068',exp:'Prophetic protection until morning.',pts:5,al:'lwa'}
]},
{name:'üåô Isha & Night',items:[
{id:'isha',label:'Isha prayer',ref:'Muslim 656',rl:'https://sunnah.com/muslim:656',exp:'Praying Isha and Fajr in congregation equals standing the whole night.',pts:15},
{id:'isha-sunnah',label:'2 Sunnah after Isha',ref:'Muslim 728',rl:'https://sunnah.com/muslim:728',exp:'Established Sunnah ‚Äî completes the night prayers.',pts:8},
{id:'tarawih',label:'Tarawih',ref:'Bukhari 2009',rl:'https://sunnah.com/bukhari:2009',exp:'Forgiveness of past sins ‚Äî unique to Ramadan.',pts:10,stk:'night'},
{id:'witr',label:'Witr (1 or 3 rakahs)',ref:'Bukhari 998',rl:'https://sunnah.com/bukhari:998',exp:'Make it your last prayer of the night.',pts:8},
{id:'night-adhkar',label:'Night adhkar before sleep',ref:'Bukhari 6320',rl:'https://sunnah.com/bukhari:6320',exp:'Ayatul Kursi, last 2 ayat of Baqarah ‚Äî protection through the night.',pts:5,al:'lwa'},
{id:'tahajjud',label:'Tahajjud (last third of night)',ref:'Bukhari 1145',rl:'https://sunnah.com/bukhari:1145',exp:'Allah descends and asks: "Who calls upon Me that I may answer?"',pts:10,stk:'night'},
{id:'dua-night',label:'Dua in last third of night',ref:'Bukhari 1145',rl:'https://sunnah.com/bukhari:1145',exp:'The most blessed time for supplication ‚Äî Allah answers.',pts:5}
]}
]},
{id:'quran',title:'2. QURAN ‚Äî UNDERSTAND & IMPLEMENT',hn:'"Fasting and the Quran will intercede for a servant on the Day of Resurrection." ‚Äî Ahmad 6626',items:[
{id:'quran-recitation',label:'Quran recitation (daily portion)',ref:'Quran 2:185',rl:'',exp:'Ramadan is the month of Quran ‚Äî recite your daily pages.',pts:10,stk:'quran',al:'trt'},
{id:'quran-reflection',label:'Reflected on meaning (tadabbur)',ref:'Quran 38:29',rl:'',exp:'Pondering deeply transforms the heart and guides action.',pts:10,stk:'quran'},
{id:'quran-implementation',label:"Applied a lesson from today's reading",ref:'Quran 2:44',rl:'',exp:'Knowledge without action is incomplete.',pts:10},
{id:'quran-listening',label:'Listened to Quran recitation',ref:'Quran 7:204',rl:'',exp:'Listen and be silent so that you may receive mercy.',pts:5,stk:'quran',al:'trt'},
{id:'quran-memorization',label:'Memorised new ayah(s)',ref:'Bukhari 5027',rl:'https://sunnah.com/bukhari:5027',exp:'The best of you are those who learn the Quran and teach it.',pts:10}
]},
{id:'character',title:'3. INTENTION, HEART & CHARACTER',hn:'"Actions are judged by intentions, and every person will get what they intended." ‚Äî Bukhari 1',items:[
{id:'intention',label:'Renewed intention (ikhlas)',ref:'Bukhari 1',rl:'https://sunnah.com/bukhari:1',exp:'Every action takes its value from the heart.',pts:7},
{id:'riya',label:'Checked and corrected riya',ref:'Muslim 2985',rl:'https://sunnah.com/muslim:2985',exp:'Riya quietly voids reward.',pts:7},
{id:'tongue',label:'Guarded the tongue',ref:'Bukhari 1903',rl:'https://sunnah.com/bukhari:1903',exp:'Fasting disciplines speech as much as hunger.',pts:7},
{id:'arguments',label:'Avoided arguments while fasting',ref:'Bukhari 1894',rl:'https://sunnah.com/bukhari:1894',exp:'If insulted, say "I am fasting."',pts:7},
{id:'gaze',label:'Lowered the gaze',ref:'Quran 24:30',rl:'',exp:'What the eyes consume shapes the heart.',pts:7},
{id:'anger',label:'Controlled anger',ref:'Bukhari 6114',rl:'https://sunnah.com/bukhari:6114',exp:'The strong one controls himself when angry.',pts:7},
{id:'gentleness',label:'Chose gentleness in interactions',ref:'Tirmidhi 2003',rl:'https://sunnah.com/tirmidhi:2003',exp:'Nothing is heavier on the Scale than good character.',pts:7},
{id:'mercy',label:'Showed mercy to others',ref:'Tirmidhi 1924',rl:'https://sunnah.com/tirmidhi:1924',exp:'The Merciful shows mercy to those who show mercy.',pts:7},
{id:'humility',label:'Practised humility',ref:'Muslim 2588',rl:'https://sunnah.com/muslim:2588',exp:'Whoever humbles himself for Allah, Allah will raise him.',pts:7},
{id:'forgave',label:'Forgave someone',ref:'Quran 42:43',rl:'',exp:'Whoever pardons and reconciles, his reward is with Allah.',pts:7},
{id:'dua-absence',label:'Made dua for someone in their absence',ref:'Muslim 2733',rl:'https://sunnah.com/muslim:2733',exp:'An angel says: "Amin, and for you the same."',pts:7},
{id:'made-happy',label:"Made someone happy for Allah's sake",ref:'Tabarani',rl:'',exp:'The most beloved deeds include bringing joy to a believer.',pts:7}
]},
{id:'charity',title:'4. CHARITY & SERVICE',hn:'"The Prophet was the most generous of people, and he was most generous in Ramadan." ‚Äî Bukhari 6',items:[
{id:'charity-given',label:'Gave charity (any amount)',ref:'Muslim 2588',rl:'https://sunnah.com/muslim:2588',exp:'Charity does not decrease wealth.',pts:10,stk:'charity'},
{id:'fed-fasting',label:'Fed someone who was fasting',ref:'Tirmidhi 807',rl:'https://sunnah.com/tirmidhi:807',exp:'You receive the same reward as the fasting person.',pts:10,stk:'charity'},
{id:'helped-family',label:'Served or helped parents/family',ref:'Bukhari 5970',rl:'https://sunnah.com/bukhari:5970',exp:'The best of deeds after prayer is kindness to parents.',pts:10},
{id:'maintained-ties',label:'Maintained ties of kinship',ref:'Muslim 2557',rl:'https://sunnah.com/muslim:2557',exp:'Whoever maintains family ties, Allah maintains ties with him.',pts:7},
{id:'visited-sick',label:'Visited or supported the sick',ref:'Muslim 2568',rl:'https://sunnah.com/muslim:2568',exp:'Whoever visits a sick person remains in the harvest of Paradise.',pts:10},
{id:'dua-others',label:'Made dua for others privately',ref:'Muslim 2733',rl:'https://sunnah.com/muslim:2733',exp:'An angel says: "Amin, and for you the same."',pts:7}
]},
{id:'lastTen',title:'5. LAST TEN NIGHTS ‚Äî SEEK LAYLATUL QADR',l10:true,hn:'"Seek Laylatul Qadr in the odd nights of the last ten days." ‚Äî Bukhari 2017. It could be ANY of the last ten nights ‚Äî strive every single night.',items:[
{id:'laylat-qadr',label:'Sought Laylat al-Qadr tonight',ref:'Quran 97:3',rl:'',exp:'Better than 1,000 months. Strive every night.',pts:15},
{id:'extra-dua',label:"Allahumma innaka 'afuwwun tuhibbul 'afwa fa'fu 'anni",ref:'Tirmidhi 3513',rl:'https://sunnah.com/tirmidhi:3513',exp:'The dua the Prophet taught Aishah for Laylatul Qadr.',pts:10},
{id:'extra-quran',label:'Extra Quran recitation',ref:'Bukhari 4997',rl:'https://sunnah.com/bukhari:4997',exp:'The Prophet intensified Quran in the last ten.',pts:10},
{id:'night-charity',label:'Night charity (hidden sadaqah)',ref:'Bukhari 1423',rl:'https://sunnah.com/bukhari:1423',exp:'Hidden charity ‚Äî his left hand does not know what his right gives.',pts:10},
{id:'long-sujood',label:'Extra long sujood with dua',ref:'Muslim 482',rl:'https://sunnah.com/muslim:482',exp:'The closest a servant is to Allah is in sujood.',pts:10},
{id:'dua-list',label:'Personal dua list ‚Äî recited with conviction',ref:'',rl:'',exp:'Prepare your requests for these blessed nights.',pts:5},
{id:'itikaf',label:"I'tikaf (even partial)",ref:'Bukhari 2025',rl:'https://sunnah.com/bukhari:2025',exp:"The Prophet observed I'tikaf in the last ten days every Ramadan.",pts:15}
]},
{id:'endOfDay',title:'6. END-OF-DAY REVIEW',items:[
{id:'istighfar-sleep',label:'Istighfar before sleep',ref:'Bukhari 6307',rl:'https://sunnah.com/bukhari:6307',exp:'End the day with a clean slate.',pts:5},
{id:'accountability',label:'Self-accountability (muhasaba)',ref:'Quran 59:18',rl:'',exp:'"Let every soul look to what it has sent forth for tomorrow."',pts:5},
{id:'renew-tomorrow',label:'Renewed intention for tomorrow',ref:'Bukhari 6464',rl:'https://sunnah.com/bukhari:6464',exp:'The most beloved deeds to Allah are the most consistent.',pts:5},
{id:'sleep-early',label:'Slept early for Fajr',ref:'Abu Dawud 4723',rl:'https://sunnah.com/abudawud:4723',exp:'The Prophet disliked talking after Isha. Protect your Fajr.',pts:5}
]},
{id:'avoidance',title:'7. DAILY AVOIDANCE CHECK',hn:'"Whoever does not give up false speech and acting upon it, Allah has no need of him giving up his food and drink." ‚Äî Bukhari 1903',items:[
{id:'no-lying',label:'No lying',ref:'Bukhari 1903',rl:'https://sunnah.com/bukhari:1903',exp:'False speech nullifies the spiritual reward of fasting.',pts:5},
{id:'no-backbiting',label:'No backbiting (gheebah)',ref:'Quran 49:12',rl:'',exp:'Like eating the flesh of your dead brother.',pts:5},
{id:'no-riya',label:'No showing off (riya)',ref:'Muslim 2985',rl:'https://sunnah.com/muslim:2985',exp:'Deeds done for show are rejected.',pts:5},
{id:'no-excess-media',label:'No excessive social media',ref:'Quran 23:3',rl:'',exp:'The believers turn away from ill speech.',pts:5},
{id:'no-useless-scrolling',label:'No useless scrolling',ref:'Tirmidhi 2416',rl:'https://sunnah.com/tirmidhi:2416',exp:'You will be asked about your time.',pts:5},
{id:'no-haram-content',label:'No music/inappropriate content',ref:'Quran 17:36',rl:'',exp:'The hearing, sight and heart will all be questioned.',pts:5},
{id:'no-overeating',label:'No overeating at iftar',ref:'Tirmidhi 2380',rl:'https://sunnah.com/tirmidhi:2380',exp:'One-third food, one-third water, one-third air.',pts:5},
{id:'no-wasting-food',label:'No wasting food',ref:'Quran 7:31',rl:'',exp:'Allah does not love the wasteful.',pts:5},
{id:'no-neglect-salah',label:'No neglecting prayers',ref:'Quran 19:59',rl:'',exp:'There came successors who neglected prayer and pursued desires.',pts:5}
]},
{id:'abuBakr',title:'8. ABU BAKR CHALLENGE ‚≠ê',hn:'The Prophet asked four questions. Abu Bakr answered "I did" to all. The Prophet said: "Whoever combines these will enter Jannah." ‚Äî Muslim 1028',items:[
{id:'abu-bakr-fasting',label:'"Who among you is fasting today?" ‚Äî I am.',ref:'Muslim 1028',rl:'https://sunnah.com/muslim:1028',exp:'',pts:10},
{id:'abu-bakr-funeral',label:'"Who attended a funeral?" ‚Äî I did.',ref:'Muslim 1028',rl:'https://sunnah.com/muslim:1028',exp:'Praying janazah or making dua for the deceased.',pts:10},
{id:'abu-bakr-fed',label:'"Who fed a poor person?" ‚Äî I did.',ref:'Muslim 1028',rl:'https://sunnah.com/muslim:1028',exp:'Even a small meal or date counts.',pts:10},
{id:'abu-bakr-sick',label:'"Who visited a sick person?" ‚Äî I did.',ref:'Muslim 1028',rl:'https://sunnah.com/muslim:1028',exp:'A visit, call, or message of support.',pts:10}
]}
];

let ST={day:1,theme:'dark',tab:'today'},qPages={},tChart=null,qChart=null,deferPr=null;
var haydOn=false;
const HAYD_OFF=['fajr-sunnah','fajr','duha','dhuhr-sunnah-before','dhuhr','dhuhr-sunnah-after','asr','dua-iftar','maghrib','maghrib-sunnah','isha','isha-sunnah','tarawih','witr','tahajjud','long-sujood','abu-bakr-fasting','itikaf'];
document.addEventListener('DOMContentLoaded',()=>{loadSt();renderCK();loadDay();updUI();updQ();renderCal();renderHeat();renderBdg();updStats();regSW();chkInst();chkDailyReminder();});

function loadSt(){const s=localStorage.getItem('rs-settings');if(s)ST={...ST,...JSON.parse(s)};document.documentElement.setAttribute('data-theme',ST.theme);updThm();const q=localStorage.getItem('rs-quran-pages');if(q)qPages=JSON.parse(q);}
function saveSt(){localStorage.setItem('rs-settings',JSON.stringify({day:ST.day,theme:ST.theme}));}
function changeDay(d){const n=ST.day+d;if(n>=1&&n<=30){saveDay();ST.day=n;saveSt();renderCK();loadDay();updUI();updQ();}}
function toggleTheme(){ST.theme=ST.theme==='light'?'dark':'light';document.documentElement.setAttribute('data-theme',ST.theme);updThm();saveSt();}
function updThm(){document.getElementById('themeIcon').textContent=ST.theme==='dark'?'‚òÄÔ∏è':'üåô';var t=document.getElementById('dmTgl');if(t)t.classList.toggle('on',ST.theme==='dark');}
function toggleHayd(){haydOn=!haydOn;applyHayd();onCK();}
function applyHayd(){var tgl=document.getElementById('haydTgl');var sw=document.getElementById('haydSw');tgl.classList.toggle('active',haydOn);sw.classList.toggle('on',haydOn);HAYD_OFF.forEach(function(id){var el=document.getElementById('item-'+id);if(el){el.classList.toggle('hayd-off',haydOn);var cb=document.getElementById(id);if(cb){if(haydOn){cb.checked=false;cb.disabled=true;}else{cb.disabled=false;}}}});}
function goTab(t){ST.tab=t;document.querySelectorAll('.tab').forEach(e=>e.classList.remove('on'));document.getElementById('tab-'+t).classList.add('on');document.querySelectorAll('.bnav-i').forEach(e=>e.classList.remove('on'));document.querySelector('[data-tab="'+t+'"]').classList.add('on');if(t==='stats'){updStats();renderCharts();updComp();}if(t==='calendar'){renderCal();renderHeat();}}
function isL10(){return ST.day>=21;}
function isOdd(){return isL10()&&[21,23,25,27,29].includes(ST.day);}

function updUI(){
  document.getElementById('currentDay').textContent=ST.day;
  document.getElementById('dayDisp').textContent='Day '+ST.day+' / 30';
  document.getElementById('dayBanner').classList.toggle('l10',isL10());
  var h=HADITHS[ST.day-1];
  var hl=h.l?'<a href="'+h.l+'" target="_blank" rel="noopener" style="color:inherit">'+h.s+'</a>':h.s;
  document.getElementById('dailyHadith').innerHTML='"'+h.t+'" ‚Äî <em>'+hl+'</em>';
  document.getElementById('oddBadge').innerHTML=isOdd()?'<div class="odd-badge">üåô Seek Laylatul Qadr Tonight</div>':'';
  document.getElementById('l10Msg').innerHTML=(isL10()&&!isOdd())?'<div class="l10-msg">üî• Last 10 Nights ‚Äî strive every night, Laylatul Qadr could be tonight!</div>':'';
  var ls=document.querySelector('[data-sec="lastTen"]');
  if(ls){ls.style.display=isL10()?'block':'none';if(isL10())ls.classList.add('l10-sec');}
}

function logQuran(){var inp=document.getElementById('qInp');var v=parseInt(inp.value);if(isNaN(v)||v<0){toast('Please enter a valid number');return;}qPages[ST.day]=v;localStorage.setItem('rs-quran-pages',JSON.stringify(qPages));inp.value='';toast(v+' pages logged for Day '+ST.day+'! üìñ');updQ();var cb=document.getElementById('quran-recitation');if(cb&&!cb.checked&&v>0){cb.checked=true;onCK();}}
function updQ(){
  var tot=0;for(var d=1;d<=30;d++)if(qPages[d])tot+=qPages[d];
  var left=Math.max(0,TOTAL_Q-tot),dLeft=Math.max(1,30-ST.day+1),pace=left>0?Math.ceil(left/dLeft):0;
  var pct=Math.min(100,Math.round((tot/TOTAL_Q)*100));
  var juz=Math.min(30,Math.ceil(tot/PPJ)||0);
  document.getElementById('qRead').textContent=tot;
  document.getElementById('qLeft').textContent=left;
  document.getElementById('qDays').textContent=dLeft;
  document.getElementById('qPace').textContent=left===0?'‚úÖ':'~'+pace;
  document.getElementById('qBar').style.width=pct+'%';
  document.getElementById('qJuz').textContent=left===0?'‚úÖ Complete!':tot===0?'‚Äî / 30':'Juz '+juz+' / 30';
  var m=document.getElementById('qMsg');
  if(tot===0)m.textContent='Read, understand, and implement ‚Äî even one ayah a day transforms your life.';
  else if(pct>=100)m.textContent='Alhamdulillah! Quran completed. Now revisit, reflect deeply, and live by its guidance.';
  else if(pct>=75)m.textContent='Almost there! '+left+' pages left. Focus on quality ‚Äî understand each ayah.';
  else if(pct>=50)m.textContent='Over halfway! ~'+pace+' pages/day to finish. Read with tadabbur.';
  else m.textContent=left+' pages remaining (~'+pace+'/day). Ponder, understand, and live by it.';
  var inp2=document.getElementById('qInp');if(inp2)inp2.placeholder=qPages[ST.day]?'Today: '+qPages[ST.day]+' pages':'Pages read today';
  var sq=document.getElementById('sQT');if(sq)sq.textContent=tot+' / 604';
}

function findIt(id){for(var s=0;s<CK.length;s++){var sec=CK[s];if(sec.subs)for(var j=0;j<sec.subs.length;j++)for(var k=0;k<sec.subs[j].items.length;k++)if(sec.subs[j].items[k].id===id)return sec.subs[j].items[k];if(sec.items)for(var j=0;j<sec.items.length;j++)if(sec.items[j].id===id)return sec.items[j];}return null;}

function renderCK(){
  var c=document.getElementById('chkContainer');c.innerHTML='';
  CK.forEach(function(sec){
    if(sec.l10&&!isL10())return;
    var el=document.createElement('div');el.className='sec';el.setAttribute('data-sec',sec.id);
    if(sec.l10)el.classList.add('l10-sec');
    var tot=sec.subs?sec.subs.reduce(function(a,s){return a+s.items.length;},0):(sec.items?sec.items.length:0);
    var h='<div class="sec-hd" onclick="togSec(\''+sec.id+'\')"><h2>'+sec.title+'</h2><div class="sec-prog"><span id="sp-'+sec.id+'">0/'+tot+'</span><span class="sec-chev">‚ñº</span></div></div><div class="sec-bd">';
    if(sec.hn)h+='<div class="hadith-n">'+sec.hn+'</div>';
    if(sec.subs)sec.subs.forEach(function(sub){h+='<div class="sub-t">'+sub.name+'</div>';sub.items.forEach(function(i){h+=mkItem(i);});});
    if(sec.items)sec.items.forEach(function(i){h+=mkItem(i);});
    h+='</div>';el.innerHTML=h;c.appendChild(el);
  });
}
function mkItem(it){
  var rl=it.rl?'<a href="'+it.rl+'" target="_blank" rel="noopener">'+it.ref+'</a>':it.ref;
  var al='';
  if(it.al==='lwa')al='<a href="https://lifewithallah.com/app" target="_blank" rel="noopener" class="ail"><span class="ail-i">ü§≤</span><span class="ail-t"><strong>Life with Allah</strong> ‚Äî Authentic adhkar & duas app</span><span class="ail-a">‚Üí</span></a>';
  if(it.al==='trt')al='<a href="https://tarteel.ai/" target="_blank" rel="noopener" class="ail"><span class="ail-i">üìñ</span><span class="ail-t"><strong>Tarteel AI</strong> ‚Äî AI Quran recitation & memorisation</span><span class="ail-a">‚Üí</span></a>';
  return '<div class="chk" id="item-'+it.id+'"><input type="checkbox" id="'+it.id+'" onchange="onCK()"><label for="'+it.id+'">'+it.label+' <span class="chk-pts">+'+it.pts+'</span>'+(it.ref?'<span class="chk-ref">'+rl+'</span>':'')+(it.exp?'<span class="chk-exp">'+it.exp+'</span>':'')+'</label></div>'+al;
}
function togSec(id){document.querySelector('[data-sec="'+id+'"]').classList.toggle('shut');}
function onCK(){saveDay();updProg();updStreaks();chkBdg();updStats();chkStreakWarn();}

function dayKey(){return 'rs-day-'+ST.day;}
function saveDay(){
  var cbs=document.querySelectorAll('.chk input[type="checkbox"]');
  var d={day:ST.day,ck:{},ts:Date.now(),hayd:haydOn};var pts=0,done=0,tot=0;
  cbs.forEach(function(cb){if(haydOn&&HAYD_OFF.indexOf(cb.id)>=0)return;d.ck[cb.id]=cb.checked;if(cb.checked){var it=findIt(cb.id);if(it)pts+=it.pts;done++;}tot++;});
  if(isL10())pts=Math.floor(pts*(isOdd()?3:2));
  d.done=done;d.tot=tot;d.pct=tot>0?Math.round((done/tot)*100):0;d.pts=pts;
  localStorage.setItem(dayKey(),JSON.stringify(d));return d;
}
function loadDay(){var s=localStorage.getItem(dayKey());if(s){var d=JSON.parse(s);haydOn=!!d.hayd;var ck=d.ck||d.checklist||{};Object.keys(ck).forEach(function(id){var cb=document.getElementById(id);if(cb){cb.checked=ck[id];updItemUI(id);}});}else{haydOn=false;}applyHayd();updProg();updStreaks();prevStreaks={fajr:calcStreak(function(c){return c&&c['fajr'];}),night:calcStreak(function(c){return c&&(c['tarawih']||c['tahajjud']);}),quran:calcStreak(function(c){return c&&(c['quran-recitation']||c['quran-reflection']||c['quran-listening']);}),charity:calcStreak(function(c){return c&&(c['charity-given']||c['fed-fasting']);})};}
function getDay(n){var s=localStorage.getItem('rs-day-'+n);if(!s)return null;var d=JSON.parse(s);return{ck:d.ck||d.checklist||{},pct:d.pct||d.percentage||0,pts:d.pts||d.points||0,done:d.done||d.completedCount||0,tot:d.tot||d.totalCount||0,hayd:!!d.hayd};}
function updItemUI(id){var cb=document.getElementById(id);var el=document.getElementById('item-'+id);if(cb&&el)el.classList.toggle('done',cb.checked);}

function updProg(){
  var cbs=document.querySelectorAll('.chk input[type="checkbox"]');var done=0,tot=0,pts=0;
  cbs.forEach(function(cb){if(haydOn&&HAYD_OFF.indexOf(cb.id)>=0){updItemUI(cb.id);return;}tot++;if(cb.checked){done++;var it=findIt(cb.id);if(it)pts+=it.pts;}updItemUI(cb.id);});
  if(isL10())pts=Math.floor(pts*(isOdd()?3:2));
  var pct=tot>0?Math.round((done/tot)*100):0;
  document.getElementById('pPct').textContent=pct+'%';document.getElementById('pBar').style.width=pct+'%';
  document.getElementById('pCnt').textContent=done+' of '+tot+' completed';document.getElementById('pPts').textContent=pts;
  CK.forEach(function(sec){if(sec.l10&&!isL10())return;var sc=0,st=0;
    if(sec.subs)sec.subs.forEach(function(sub){sub.items.forEach(function(it){if(haydOn&&HAYD_OFF.indexOf(it.id)>=0)return;st++;var cb=document.getElementById(it.id);if(cb&&cb.checked)sc++;});});
    if(sec.items)sec.items.forEach(function(it){if(haydOn&&HAYD_OFF.indexOf(it.id)>=0)return;st++;var cb=document.getElementById(it.id);if(cb&&cb.checked)sc++;});
    var el=document.getElementById('sp-'+sec.id);if(el)el.textContent=sc+'/'+st;});
}

function calcStreak(fn){var s=0;for(var d=ST.day-1;d>=1;d--){var x=getDay(d);if(x&&fn(x.ck))s++;else break;}
  var td=getDay(ST.day);var live={};document.querySelectorAll('.chk input[type="checkbox"]').forEach(function(cb){live[cb.id]=cb.checked;});
  if(td&&fn(td.ck))s++;else if(fn(live))s++;return s;}
function updStreaks(){
  var fs=calcStreak(function(c){return c&&c['fajr'];}),ns=calcStreak(function(c){return c&&(c['tarawih']||c['tahajjud']);}),
    qs=calcStreak(function(c){return c&&(c['quran-recitation']||c['quran-reflection']||c['quran-listening']);}),
    cs=calcStreak(function(c){return c&&(c['charity-given']||c['fed-fasting']);});
  document.getElementById('sFajrN').textContent=fs;document.getElementById('sNightN').textContent=ns;
  document.getElementById('sQuranN').textContent=qs;document.getElementById('sCharityN').textContent=cs;
  [{n:'Fajr',v:fs},{n:'Night',v:ns},{n:'Quran',v:qs},{n:'Charity',v:cs}].forEach(function(x){document.getElementById('s'+x.n).classList.toggle('on',x.v>0);});
  saveBest({fajr:fs,night:ns,quran:qs,charity:cs});
}
function saveBest(c){var s=JSON.parse(localStorage.getItem('rs-best-streaks')||'{}');var u={fajr:Math.max(s.fajr||0,c.fajr),night:Math.max(s.night||0,c.night),quran:Math.max(s.quran||0,c.quran),charity:Math.max(s.charity||0,c.charity)};localStorage.setItem('rs-best-streaks',JSON.stringify(u));}
function getBest(){return JSON.parse(localStorage.getItem('rs-best-streaks')||'{"fajr":0,"night":0,"quran":0,"charity":0}');}

function renderBdg(){var g=document.getElementById('bdgGrid');var u=getUBdg();g.innerHTML=BADGES.map(function(b){return '<div class="bdg '+(u[b.id]?'unlk':'lck')+'"><div class="bdg-i">'+b.icon+'</div><div class="bdg-n">'+b.name+'</div></div>';}).join('');document.getElementById('bdgCnt').textContent=Object.values(u).filter(Boolean).length;}
function getUBdg(){return JSON.parse(localStorage.getItem('rs-badges')||'{}');}
function unlock(id){var b=getUBdg();if(!b[id]){b[id]={u:1,d:new Date().toISOString()};localStorage.setItem('rs-badges',JSON.stringify(b));var bg=BADGES.find(function(x){return x.id===id;});if(bg)toast(bg.icon+' Badge: '+bg.name+'!','bdg');renderBdg();}}
function chkBdg(){
  var td=saveDay();if(ST.day===1&&td.pct>0)unlock('firstStep');
  var dp=0;for(var d=1;d<=7;d++){var x=getDay(d);if(x&&x.pct>0)dp++;}if(dp>=7)unlock('weekOne');
  dp=0;for(var d=1;d<=15;d++){var x=getDay(d);if(x&&x.pct>0)dp++;}if(dp>=15)unlock('halfway');
  if(calcStreak(function(c){return c&&c['fajr'];})>=10)unlock('fajrWarrior');
  var tc=0;for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.ck&&x.ck['tahajjud'])tc++;}if(tc>=10)unlock('nightOwl');
  var qd=0;for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.ck&&(x.ck['quran-recitation']||x.ck['quran-reflection']))qd++;}if(qd>=20)unlock('quranLover');
  var cd=0;for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.ck&&(x.ck['charity-given']||x.ck['fed-fasting']))cd++;}if(cd>=15)unlock('generous');
  var abi=['abu-bakr-fasting','abu-bakr-funeral','abu-bakr-fed','abu-bakr-sick'];var abc=0;
  for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.ck&&abi.every(function(i){return x.ck[i];})){unlock('abuBakr');abc++;}}if(abc>=5)unlock('abuBakrG');
  var pd=0;for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.pct===100)pd++;}if(pd>=3)unlock('perfect');
  if(ST.day>=30){var lt=0,ld=0;for(var d=21;d<=30;d++){var x=getDay(d);if(x){lt+=x.pct;ld++;}}if(ld===10&&(lt/10)>=80)unlock('l10Hero');var q=0;for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.pct>=70)q++;}if(q===30)unlock('champion');}
}

function renderHeat(){
  var g=document.getElementById('heatGrid');g.innerHTML='';
  for(var d=1;d<=30;d++){var x=getDay(d);var lv=0;
    if(x){if(x.pct>=76)lv=4;else if(x.pct>=51)lv=3;else if(x.pct>=26)lv=2;else if(x.pct>0)lv=1;}
    var c=document.createElement('div');c.className='heat-c h'+lv+(d===ST.day?' h-today':'')+(x&&x.hayd?' h-hayd':'');
    c.textContent=d;c.title='Day '+d+': '+(x?x.pct+'%':'‚Äî')+(x&&x.hayd?' üå∏':'');c.onclick=(function(dd){return function(){showMdl(dd);};})(d);g.appendChild(c);}
}
function renderCal(){
  var g=document.getElementById('calGrid');g.innerHTML='';
  for(var d=1;d<=30;d++){var x=getDay(d);var today=d===ST.day;var odd=d>=21&&[21,23,25,27,29].indexOf(d)>=0;
    var cc='',pct='‚Äî';if(x){pct=x.pct+'%';if(x.pct>=76)cc='cd-hi';else if(x.pct>=51)cc='cd-md';else if(x.pct>0)cc='cd-lo';}
    if(x&&x.hayd)cc='cd-hayd';
    var el=document.createElement('div');el.className='cal-d '+cc+(today?' cd-today':'')+(odd?' cd-odd':'');
    el.innerHTML='<b>'+d+'</b><small>'+(x&&x.hayd?'üå∏':pct)+'</small>';el.onclick=(function(dd){return function(){showMdl(dd);};})(d);g.appendChild(el);}
}
function showMdl(day){
  document.getElementById('mdlTitle').textContent='Day '+day+' of Ramadan';var x=getDay(day);var h='';
  if(x){var qp=qPages[day]||0;
    h=(x.hayd?'<div style="text-align:center;padding:8px 12px;margin-bottom:14px;background:rgba(244,114,182,.08);border:1px solid rgba(244,114,182,.2);border-radius:12px;font-size:.85em;color:#f472b6">üå∏ Menstrual cycle day ‚Äî adjusted checklist</div>':'')+'<div style="text-align:center;margin-bottom:20px"><div style="font-size:2.8em;font-weight:800;color:var(--green);font-family:var(--ff);line-height:1">'+x.pct+'%</div><div style="color:var(--text3);margin-top:4px">'+x.done+' of '+x.tot+' completed</div><div style="color:var(--gold);font-weight:600;margin-top:6px">üî• '+x.pts+' points</div>'+(qp?'<div style="color:var(--green);margin-top:4px">üìñ '+qp+' Quran pages</div>':'')+'</div><h4 style="margin-bottom:10px;color:var(--green);font-family:var(--ff)">Completed:</h4><div style="max-height:280px;overflow-y:auto">'+Object.entries(x.ck).filter(function(e){return e[1];}).map(function(e){var it=findIt(e[0]);return it?'<div style="padding:6px 0;border-bottom:1px solid var(--border);font-size:.86em">‚úÖ '+it.label+'</div>':'';}).join('')+'</div>';
  }else h='<p style="text-align:center;color:var(--text3);padding:30px 0">No data recorded yet.</p>';
  document.getElementById('mdlBody').innerHTML=h;document.getElementById('dayModal').classList.add('on');
}
function closeMdl(){document.getElementById('dayModal').classList.remove('on');}
document.getElementById('dayModal').addEventListener('click',function(e){if(e.target.id==='dayModal')closeMdl();});

function renderCharts(){
  var dk=ST.theme==='dark',gc=dk?'rgba(255,255,255,.06)':'rgba(0,0,0,.06)',tc=dk?'#a8a29e':'#78716c';
  var labels=[],pcts=[];for(var d=1;d<=30;d++){labels.push(d);var x=getDay(d);pcts.push(x?x.pct:0);}
  if(tChart)tChart.destroy();
  tChart=new Chart(document.getElementById('trendChart'),{type:'line',data:{labels:labels,datasets:[{label:'Completion %',data:pcts,borderColor:dk?'#4ade80':'#15803d',backgroundColor:dk?'rgba(74,222,128,.08)':'rgba(21,128,61,.08)',fill:true,tension:.35,pointRadius:3,pointBackgroundColor:dk?'#4ade80':'#15803d',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,max:100,grid:{color:gc},ticks:{color:tc,font:{size:10}}},x:{grid:{color:gc},ticks:{color:tc,maxTicksLimit:10,font:{size:10}}}},plugins:{legend:{display:false}}}});
  var qL=[],qC=[];var cum=0;for(var d=1;d<=30;d++){qL.push(d);cum+=(qPages[d]||0);qC.push(cum);}
  var tgt=[];for(var d=1;d<=30;d++)tgt.push(Math.round((d/30)*604));
  if(qChart)qChart.destroy();
  qChart=new Chart(document.getElementById('quranChart'),{type:'line',data:{labels:qL,datasets:[{label:'Pages Read',data:qC,borderColor:'#fbbf24',backgroundColor:'rgba(251,191,36,.08)',fill:true,tension:.35,pointRadius:3,pointBackgroundColor:'#fbbf24',borderWidth:2},{label:'Target',data:tgt,borderColor:dk?'rgba(255,255,255,.15)':'rgba(0,0,0,.12)',borderDash:[5,5],pointRadius:0,fill:false,borderWidth:1.5}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,max:604,grid:{color:gc},ticks:{color:tc,font:{size:10}}},x:{grid:{color:gc},ticks:{color:tc,maxTicksLimit:10,font:{size:10}}}},plugins:{legend:{labels:{color:tc,boxWidth:10,font:{size:10}}}}}});
}

// COMPARISON ‚Äî BUG FIX: only show from week 2+
function updComp(){
  var weekOf=function(d){return d<=7?1:d<=14?2:d<=21?3:4;};
  var wAvg=function(s,e){var t=0,c=0;for(var d=s;d<=e;d++){var x=getDay(d);if(x&&x.pct>0){t+=x.pct;c++;}}return c>0?Math.round(t/c):0;};
  var cw=weekOf(ST.day);
  var compSec=document.getElementById('compSection');
  if(cw<=1){compSec.style.display='none';return;}
  compSec.style.display='block';
  var ranges=[[1,7],[8,14],[15,21],[22,30]];
  var curAvg=wAvg(ranges[cw-1][0],ranges[cw-1][1]);var prevAvg=wAvg(ranges[cw-2][0],ranges[cw-2][1]);
  document.getElementById('cW1').textContent=prevAvg+'%';document.getElementById('cW1L').textContent='Week '+(cw-1)+' Avg';
  document.getElementById('cW2').textContent=curAvg+'%';document.getElementById('cW2L').textContent='Week '+cw+' Avg';
  var delta=document.getElementById('cDelta');
  if(prevAvg>0){var diff=curAvg-prevAvg;delta.style.display='block';
    document.getElementById('cDV').textContent=(diff>=0?'+':'')+diff+'%';
    document.getElementById('cDV').style.color=diff>=0?'var(--success)':'var(--error)';
    document.getElementById('cDL').textContent=diff>=0?"You're doing "+Math.abs(diff)+'% better than last week!':Math.abs(diff)+'% lower than last week ‚Äî you can do this!';
  }else delta.style.display='none';
}

function updStats(){
  var dc=0,tp=0,tpt=0,bd={d:0,p:0},pd=0;
  for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.pct>0){dc++;tp+=x.pct;tpt+=x.pts;if(x.pct>bd.p)bd={d:d,p:x.pct};if(x.pct===100)pd++;}}
  document.getElementById('sDC').textContent=dc+' / 30';
  document.getElementById('sAC').textContent=(dc>0?Math.round(tp/dc):0)+'%';
  document.getElementById('sTP').textContent=tpt.toLocaleString();
  document.getElementById('sBD').textContent=bd.d>0?'Day '+bd.d+' ('+bd.p+'%)':'-';
  document.getElementById('sPD').textContent=pd;
  var bs=getBest();
  document.getElementById('bsF').textContent=bs.fajr+' days';document.getElementById('bsN').textContent=bs.night+' days';
  document.getElementById('bsQ').textContent=bs.quran+' days';document.getElementById('bsC').textContent=bs.charity+' days';
  updCat();updQ();
}
function updCat(){
  var c=document.getElementById('catBrk');
  var cats=[{id:'salah',n:'Salah & Dhikr'},{id:'quran',n:'Quran'},{id:'character',n:'Character'},{id:'charity',n:'Charity'},{id:'avoidance',n:'Avoidance'}];
  c.innerHTML=cats.map(function(cat){var sec=CK.find(function(s){return s.id===cat.id;});if(!sec)return'';var co=0,t=0;
    if(sec.subs)sec.subs.forEach(function(sub){sub.items.forEach(function(it){if(haydOn&&HAYD_OFF.indexOf(it.id)>=0)return;t++;var cb=document.getElementById(it.id);if(cb&&cb.checked)co++;});});
    if(sec.items)sec.items.forEach(function(it){if(haydOn&&HAYD_OFF.indexOf(it.id)>=0)return;t++;var cb=document.getElementById(it.id);if(cb&&cb.checked)co++;});
    var pct=t>0?Math.round((co/t)*100):0;var nm=cat.n+(haydOn&&cat.id==='salah'?' (Dhikr only)':'');
    return '<div class="cat-bar"><div class="cat-hd"><span>'+nm+'</span><span style="font-weight:600;color:var(--green)">'+pct+'%</span></div><div class="cat-trk"><div class="cat-fill" style="width:'+pct+'%"></div></div></div>';
  }).join('');
}

function genPDF(){
  var jsPDF=window.jspdf.jsPDF;var doc=new jsPDF();var W=210,M=15;var y=20;
  var gr=[21,128,61],gd=[184,134,11],dk=[28,25,23];
  doc.setFillColor(dk[0],dk[1],dk[2]);doc.rect(0,0,W,42,'F');
  doc.setFillColor(gd[0],gd[1],gd[2]);doc.rect(0,40,W,2,'F');
  doc.setTextColor(255,255,255);doc.setFontSize(22);doc.text('RAMADAN STRIVERS',M,22);
  doc.setFontSize(10);doc.setTextColor(gd[0],gd[1],gd[2]);doc.text("Your Ramadan Planner & Tracker ‚Äî Progress Report",M,32);
  doc.setTextColor(255,255,255);doc.setFontSize(9);doc.text('Generated: '+new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),W-M,22,{align:'right'});
  y=54;doc.setTextColor(0,0,0);
  doc.setFillColor(gr[0],gr[1],gr[2]);doc.rect(M,y-6,W-2*M,10,'F');
  doc.setTextColor(255,255,255);doc.setFontSize(12);doc.text('OVERALL PROGRESS',M+4,y+1);
  y+=14;doc.setFontSize(10);
  var dc=0,tp=0,tpt=0,pd=0;
  for(var d=1;d<=30;d++){var x=getDay(d);if(x&&x.pct>0){dc++;tp+=x.pct;tpt+=x.pts;if(x.pct===100)pd++;}}
  var totalQ=0;for(var d=1;d<=30;d++)if(qPages[d])totalQ+=qPages[d];
  var avg=dc>0?Math.round(tp/dc):0;
  var stats=[['Days Completed',dc+' / 30'],['Average Completion',avg+'%'],['Total Points',String(tpt)],['Perfect Days',String(pd)],['Quran Pages',totalQ+' / 604']];
  stats.forEach(function(s){doc.setTextColor(50,50,50);doc.text(s[0],M,y);doc.setTextColor(gr[0],gr[1],gr[2]);doc.text(s[1],W-M,y,{align:'right'});y+=8;});
  y+=6;doc.setFillColor(gr[0],gr[1],gr[2]);doc.rect(M,y-6,W-2*M,10,'F');
  doc.setTextColor(255,255,255);doc.setFontSize(12);doc.text('DAILY BREAKDOWN',M+4,y+1);
  y+=12;doc.setFontSize(8);
  doc.setFillColor(240,240,240);doc.rect(M,y-4,W-2*M,8,'F');
  doc.setTextColor(80,80,80);doc.text('Day',M+2,y+1);doc.text('Completion',M+30,y+1);doc.text('Points',M+65,y+1);doc.text('Quran',M+90,y+1);doc.text('Note',M+115,y+1);
  y+=10;
  for(var d=1;d<=30;d++){if(y>270){doc.addPage();y=20;}
    var x=getDay(d);var qp=qPages[d]||0;
    if(x&&x.hayd){doc.setFillColor(253,242,248);doc.rect(M,y-4,W-2*M,7,'F');}
    else if(x&&x.pct>0){doc.setFillColor(240,250,240);doc.rect(M,y-4,W-2*M,7,'F');}
    doc.setTextColor(50,50,50);doc.text('Day '+d,M+2,y);doc.text(x?x.pct+'%':'‚Äî',M+30,y);doc.text(x?String(x.pts):'‚Äî',M+65,y);doc.text(qp>0?qp+'p':'‚Äî',M+90,y);doc.text(x&&x.hayd?'Cycle':'',M+115,y);y+=7;}
  y+=8;if(y>250){doc.addPage();y=20;}
  doc.setFillColor(gr[0],gr[1],gr[2]);doc.rect(M,y-6,W-2*M,10,'F');
  doc.setTextColor(255,255,255);doc.setFontSize(12);doc.text('BEST STREAKS',M+4,y+1);
  y+=12;doc.setFontSize(10);var bs=getBest();
  [['Fajr',bs.fajr],['Night Prayer',bs.night],['Quran',bs.quran],['Sadaqah',bs.charity]].forEach(function(s){
    doc.setTextColor(50,50,50);doc.text(s[0],M,y);doc.setTextColor(gr[0],gr[1],gr[2]);doc.text(s[1]+' days',W-M,y,{align:'right'});y+=8;});
  y+=10;if(y>270){doc.addPage();y=20;}
  doc.setDrawColor(gd[0],gd[1],gd[2]);doc.line(M,y,W-M,y);y+=8;
  doc.setFontSize(9);doc.setTextColor(gd[0],gd[1],gd[2]);doc.text('May Allah accept our fasting and deeds. Ramadan Mubarak!',W/2,y,{align:'center'});
  y+=6;doc.setTextColor(150,150,150);doc.setFontSize(7);doc.text('Ramadan Strivers v4.0',W/2,y,{align:'center'});
  doc.save('Ramadan-Strivers-Report-Day-'+ST.day+'.pdf');toast('PDF report downloaded! üìÑ');
}

window.addEventListener('beforeinstallprompt',function(e){e.preventDefault();deferPr=e;document.getElementById('instBanner').classList.add('show');});
function chkInst(){if(localStorage.getItem('rs-inst-x'))return;var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent);var sa=window.matchMedia('(display-mode:standalone)').matches||window.navigator.standalone;if(iOS&&!sa){document.getElementById('instBtn').textContent='How';document.getElementById('instBanner').classList.add('show');document.getElementById('instBtn').onclick=function(){toast('Tap Share then "Add to Home Screen"');};}}
function installApp(){if(deferPr){deferPr.prompt();deferPr.userChoice.then(function(r){if(r.outcome==='accepted')toast('App installed! üéâ');deferPr=null;document.getElementById('instBanner').classList.remove('show');});}}
function dismissInst(){document.getElementById('instBanner').classList.remove('show');localStorage.setItem('rs-inst-x','1');}
function toast(m,t){var c=document.getElementById('toastC');var el=document.createElement('div');el.className='toast '+(t==='bdg'?'bdg-t':'');el.textContent=m;c.appendChild(el);setTimeout(function(){el.remove();},3000);}
function exportData(){var d={settings:ST,badges:getUBdg(),bestStreaks:getBest(),qPages:qPages,days:{}};for(var i=1;i<=30;i++){var x=localStorage.getItem('rs-day-'+i);if(x)d.days[i]=JSON.parse(x);}var b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});var u=URL.createObjectURL(b);var a=document.createElement('a');a.href=u;a.download='ramadan-strivers-'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(u);toast('Data exported!');}
function importData(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){try{var d=JSON.parse(ev.target.result);if(d.settings)localStorage.setItem('rs-settings',JSON.stringify(d.settings));if(d.badges)localStorage.setItem('rs-badges',JSON.stringify(d.badges));if(d.bestStreaks)localStorage.setItem('rs-best-streaks',JSON.stringify(d.bestStreaks));if(d.qPages||d.quranPages)localStorage.setItem('rs-quran-pages',JSON.stringify(d.qPages||d.quranPages));if(d.days)Object.entries(d.days).forEach(function(e){localStorage.setItem('rs-day-'+e[0],JSON.stringify(e[1]));});toast('Imported! Reloading...');setTimeout(function(){location.reload();},1500);}catch(err){toast('Error importing data.');}};r.readAsText(f);}
function confirmReset(){if(confirm('Reset ALL data? This cannot be undone!')){if(confirm('This deletes all progress. Continue?')){var keys=[];for(var i=0;i<localStorage.length;i++){var k=localStorage.key(i);if(k&&k.startsWith('rs-'))keys.push(k);}keys.forEach(function(k){localStorage.removeItem(k);});toast('Reset.');setTimeout(function(){location.reload();},1500);}}}
function chkDailyReminder(){var x=getDay(ST.day);if(!x||x.done===0){setTimeout(function(){toast("You haven't logged today's progress yet ‚Äî every deed counts! üåô");},800);}}
var prevStreaks={fajr:0,night:0,quran:0,charity:0};
function chkStreakWarn(){var cur={fajr:calcStreak(function(c){return c&&c['fajr'];}),night:calcStreak(function(c){return c&&(c['tarawih']||c['tahajjud']);}),quran:calcStreak(function(c){return c&&(c['quran-recitation']||c['quran-reflection']||c['quran-listening']);}),charity:calcStreak(function(c){return c&&(c['charity-given']||c['fed-fasting']);})};var names={fajr:'Fajr ‚òÄÔ∏è',night:'Night Prayer üåô',quran:'Quran üìñ',charity:'Sadaqah üíù'};var milestones=[3,5,7,10,14,20,25,30];['fajr','night','quran','charity'].forEach(function(k){if(cur[k]>prevStreaks[k]&&milestones.indexOf(cur[k])>=0){toast('üî• '+names[k]+' streak: '+cur[k]+' days! Keep it going!');}});prevStreaks=cur;}
function regSW(){if('serviceWorker' in navigator){var code="var C='rs-v5.1';self.addEventListener('install',function(e){self.skipWaiting();});self.addEventListener('fetch',function(e){e.respondWith(caches.match(e.request).then(function(r){return r||fetch(e.request).catch(function(){return new Response('Offline');});}));});self.addEventListener('activate',function(e){e.waitUntil(caches.keys().then(function(n){return Promise.all(n.filter(function(x){return x!==C;}).map(function(x){return caches.delete(x);}));}));});";try{navigator.serviceWorker.register(URL.createObjectURL(new Blob([code],{type:'application/javascript'})));}catch(e){}}}
</script>
</body>
</html>
